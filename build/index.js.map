{"version":3,"sources":["../src/index.js"],"names":["debug","hostname","port","server","createServer","req","res","parsedUrl","parse","url","pathname","toLowerCase","query","start","then","data","writeHead","write","JSON","stringify","end","catch","errorData","msg","error","e","Promise","all","resolve","reject","returnOb","mobile","title","description","image","console","log","require","inspect","depth","colors","process","env","NODE_ENV","urls","allPromises","map","el","listen"],"mappings":";;AAAA;;;;AACA;;;;AACA;;AACA;;AACA;;;;;;AAEA,IAAMA,QAAQ,qBAAE,YAAF,CAAd;AACA,IAAMC,WAAW,WAAjB;AACA,IAAMC,OAAO,IAAb;;AAEA,IAAMC,SAAS,eAAKC,YAAL,CAAkB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC7C,MAAIC,YAAY,cAAIC,KAAJ,CAAUH,IAAII,GAAd,EAAmB,IAAnB,CAAhB;AACAT,QAAM,YAAN;AACA,MAAIO,UAAUG,QAAV,CAAmBC,WAAnB,OAAqC,MAArC,IAA+CJ,UAAUK,KAAV,CAAgBH,GAAnE,EAAwE;AACtET,UAAM,+BAAN;AACAa,UAAMN,SAAN,EACGO,IADH,CACQ,gBAAQ;AACZd,YAAM,oBAAN,EAA4Be,IAA5B;AACAT,UAAIU,SAAJ,CAAc,GAAd,EAAmB,EAAC,gBAAgB,kBAAjB,EAAnB;AACAV,UAAIW,KAAJ,CAAUC,KAAKC,SAAL,CAAeJ,IAAf,CAAV;AACAT,UAAIc,GAAJ;AACD,KANH,EAOGC,KAPH,CAOS,aAAK;AACV,UAAMC,YAAY;AAChBC,aAAK,kCADW;AAEhBC,eAAOC;AAFS,OAAlB;AAIAnB,UAAIU,SAAJ,CAAc,GAAd,EAAmB,EAAC,gBAAgB,kBAAjB,EAAnB;AACAV,UAAIW,KAAJ,CAAUC,KAAKC,SAAL,CAAeG,SAAf,CAAV;AACAhB,UAAIc,GAAJ;AACD,KAfH;AAgBD;AACF,CAtBc,CAAf;;AAwBA,IAAMP,QAAQ,SAARA,KAAQ,CAACN,SAAD;AAAA,SAAemB,QAAQC,GAAR,CAAY,CACvC,4BAAcpB,UAAUK,KAAV,CAAgBH,GAA9B,CADuC,EAEvC,6BAAaF,UAAUK,KAAV,CAAgBH,GAA7B,CAFuC,CAAZ,EAG1BK,IAH0B,CAGrB,UAACC,IAAD;AAAA,WAAU,IAAIW,OAAJ,CAAY,UAACE,OAAD,EAAUC,MAAV,EAAqB;AACjD,UAAGd,IAAH,EAAS;AACP,YAAMe,WAAW;AACf,6BAAmBf,KAAK,CAAL,EAAQgB,MADZ;AAEf,mBAAShB,KAAK,CAAL,EAAQiB,KAFF;AAGf,yBAAejB,KAAK,CAAL,EAAQkB,WAHR;AAIf,sBAAYlB,KAAK,CAAL,EAAQmB,KAJL;AAKf,sBAAYnB,KAAK,CAAL;AALG,SAAjB;AAOAoB,gBAAQC,GAAR,CAAYC,QAAQ,MAAR,EAAgBC,OAAhB,CAAwBR,QAAxB,EAAkC,EAAES,OAAO,IAAT,EAAeC,QAAQ,IAAvB,EAAlC,CAAZ;AACAZ,gBAAQE,QAAR;AACD,OAVD,MAUO;AACLD,eAAO,KAAP;AACD;AAEF,KAfiB,CAAV;AAAA,GAHqB,CAAf;AAAA,CAAd;;AAoBA,IAAGY,QAAQC,GAAR,CAAYC,QAAZ,KAAuB,aAA1B,EAAyC;AACvC,MAAMC,OAAO,CACX,2EADW,EAEX,kFAFW,EAGX,4CAHW,EAIX,sFAJW,EAKX,4HALW,CAAb;AAOA,MAAMC,cAAcD,KAAKE,GAAL,CAAS;AAAA,WAAMjC,MAAM;AACvCD,aAAO;AACLH,aAAKsC;AADA;AADgC,KAAN,CAAN;AAAA,GAAT,CAApB;AAKArB,UAAQC,GAAR,CAAYkB,WAAZ,EAAyB/B,IAAzB,CAA8B,gBAAQ;AACpCd,UAAM,IAAN,EAAWe,IAAX;AACD,GAFD;AAGD;;AAEDZ,OAAO6C,MAAP,CAAc9C,IAAd,EAAoBD,QAApB,EAA8B,YAAM;AAClCD,sCAAkCC,QAAlC,SAA8CC,IAA9C;AACD,CAFD","file":"index.js","sourcesContent":["import http from 'http';\nimport url from 'url';\nimport { startCrawling } from './crawler';\nimport { startLoading } from './nightmare';\nimport d from 'Debug';\n\nconst debug = d('mainModule');\nconst hostname = '127.0.0.1';\nconst port = 3000;\n\nconst server = http.createServer((req, res) => {\n  let parsedUrl = url.parse(req.url, true);\n  debug('WE GOT HIT')\n  if (parsedUrl.pathname.toLowerCase() === '/api' && parsedUrl.query.url) {\n    debug('WE GOT HIT @ THE API ENDPOINT')\n    start(parsedUrl)\n      .then(data => {\n        debug('Returning data: %o', data);\n        res.writeHead(200, {'Content-Type': 'application/json'})\n        res.write(JSON.stringify(data));\n        res.end();\n      })\n      .catch(e => {\n        const errorData = {\n          msg: 'We could not finish your request',\n          error: e,\n        };\n        res.writeHead(500, {'Content-Type': 'application/json'})\n        res.write(JSON.stringify(errorData));\n        res.end();\n      })\n  }\n});\n\nconst start = (parsedUrl) => Promise.all([\n  startCrawling(parsedUrl.query.url),\n  startLoading(parsedUrl.query.url)\n]).then((data) => new Promise((resolve, reject) => {\n  if(data) {\n    const returnOb = {\n      \"mobile­friendly\": data[0].mobile,\n      \"title\": data[0].title,\n      \"description\": data[0].description,\n      \"imageURL\": data[0].image,\n      \"loadTime\": data[1]\n    }\n    console.log(require('util').inspect(returnOb, { depth: null, colors: true }));\n    resolve(returnOb)\n  } else {\n    reject(false)\n  }\n\n}))\n\nif(process.env.NODE_ENV==='development') {\n  const urls = [\n    'http://www.lunametrics.com/blog/2017/02/02/unlimited­data­studio­reports/',\n    'http://news.abs­cbn.com/business/01/26/17/google­philippines­to­expand­workforce',\n    'https://techcrunch.com/2016/12/15/comcast/',\n    'http://www.latimes.com/business/technology/la­fi­tn­adobe­sensei­20161206­story.html',\n    'http://www.infoworld.com/article/3162756/internet-of-things/google-strengthens-android-relationship-with-intel-in-iot.html',\n  ];\n  const allPromises = urls.map(el => start({\n    query: {\n      url: el\n    }\n  }))\n  Promise.all(allPromises).then(data => {\n    debug('%o',data);\n  })\n}\n\nserver.listen(port, hostname, () => {\n  debug(`Server running at http://${hostname}:${port}/`);\n});\n"]}